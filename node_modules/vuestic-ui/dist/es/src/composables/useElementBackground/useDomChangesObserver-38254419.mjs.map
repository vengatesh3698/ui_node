{"version":3,"file":"useDomChangesObserver-38254419.mjs","sources":["../../../../../src/composables/useElementBackground/useDomChangesObserver.ts"],"sourcesContent":["import { onBeforeUnmount, onMounted, Ref } from 'vue'\n\ntype Handler<K = any, V = any> = { cb: ((cache: Map<K, V>) => void), el: Ref<HTMLElement | undefined> }\n\nlet observer: MutationObserver | null\nlet callbacks: Handler[] = []\n\nconst createMutationObserver = () => {\n  if (!observer) {\n    const runCallbacks = (mutations: MutationRecord[]) => {\n      const cache = new Map()\n\n      for (let i = 0; i < callbacks.length; i++) {\n        if (mutations.some((m) => m.target.contains(callbacks[i].el.value || null))) {\n          callbacks[i].cb(cache)\n        }\n      }\n    }\n\n    observer = new MutationObserver((mutations) => {\n      runCallbacks(mutations)\n    })\n    observer.observe(document.documentElement, {\n      attributeFilter: ['style', 'class'],\n      subtree: true,\n      attributes: true,\n    })\n  }\n}\n\nconst destroyMutationObserver = () => {\n  if (!observer) { return }\n\n  if (callbacks.length > 0) { return }\n  observer.disconnect()\n  observer = null\n}\n\n/** Creates on global watched for dom changes */\nexport const useDomChangesObserver = <K, V>(cb: Handler<K, V>['cb'], el: Ref<HTMLElement | undefined>) => {\n  onMounted(() => {\n    createMutationObserver()\n    callbacks.push({ cb, el })\n  })\n\n  onBeforeUnmount(() => {\n    callbacks = callbacks.filter((c) => c.cb !== cb)\n    destroyMutationObserver()\n  })\n}\n"],"names":[],"mappings":";AAIA,IAAI;AACJ,IAAI,YAAuB,CAAA;AAE3B,MAAM,yBAAyB,MAAM;AACnC,MAAI,CAAC,UAAU;AACP,UAAA,eAAe,CAAC,cAAgC;AAC9C,YAAA,4BAAY;AAElB,eAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AACzC,YAAI,UAAU,KAAK,CAAC,MAAM,EAAE,OAAO,SAAS,UAAU,CAAC,EAAE,GAAG,SAAS,IAAI,CAAC,GAAG;AACjE,oBAAA,CAAC,EAAE,GAAG,KAAK;AAAA,QACvB;AAAA,MACF;AAAA,IAAA;AAGS,eAAA,IAAI,iBAAiB,CAAC,cAAc;AAC7C,mBAAa,SAAS;AAAA,IAAA,CACvB;AACQ,aAAA,QAAQ,SAAS,iBAAiB;AAAA,MACzC,iBAAiB,CAAC,SAAS,OAAO;AAAA,MAClC,SAAS;AAAA,MACT,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AACF;AAEA,MAAM,0BAA0B,MAAM;AACpC,MAAI,CAAC,UAAU;AAAE;AAAA,EAAO;AAEpB,MAAA,UAAU,SAAS,GAAG;AAAE;AAAA,EAAO;AACnC,WAAS,WAAW;AACT,aAAA;AACb;AAGa,MAAA,wBAAwB,CAAO,IAAyB,OAAqC;AACxG,YAAU,MAAM;AACS;AACvB,cAAU,KAAK,EAAE,IAAI,GAAI,CAAA;AAAA,EAAA,CAC1B;AAED,kBAAgB,MAAM;AACpB,gBAAY,UAAU,OAAO,CAAC,MAAM,EAAE,OAAO,EAAE;AACvB;EAAA,CACzB;AACH;"}