{"version":3,"file":"VaDropdown.vue_vue_type_script_lang.mjs","sources":["../../../../../src/components/va-dropdown/VaDropdown.vue"],"sourcesContent":["<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  h,\n  nextTick,\n  type PropType,\n  shallowRef,\n  toRef,\n  Fragment,\n  Teleport,\n} from 'vue'\n\nimport pick from 'lodash/pick.js'\nimport kebabCase from 'lodash/kebabCase.js'\n\nimport {\n  useComponentPresetProp,\n  useStateful, useStatefulEmits, createStatefulProps,\n  useDebounceFn,\n  useDropdown,\n  usePlacementAliasesProps,\n  useClickOutside,\n  useBem,\n  useHTMLElementSelector,\n  useIsMounted,\n  useDocument,\n  useHTMLElement,\n  MaybeHTMLElementOrSelector,\n  useTranslation,\n} from '../../composables'\nimport { useAnchorSelector } from './hooks/useAnchorSelector'\nimport { useCursorAnchor } from './hooks/useCursorAnchor'\nimport { useKeyboardNavigation, useMouseNavigation } from './hooks/useDropdownNavigation'\n\nimport { renderSlotNode } from '../../utils/headless'\nimport { warn } from '../../utils/console'\n\nimport type { DropdownOffsetProp } from './types'\n\nexport default defineComponent({\n  name: 'VaDropdown',\n\n  inheritAttrs: false,\n\n  props: {\n    ...createStatefulProps(Boolean, true),\n    ...useComponentPresetProp,\n    ...usePlacementAliasesProps,\n    disabled: { type: Boolean },\n    readonly: { type: Boolean },\n    anchorSelector: { type: String, default: '' },\n    innerAnchorSelector: { type: String, default: '' },\n    /** Viewport where dropdown will be rendered if preventOverflow is true. Autoplacement will be calculated relative to `target` */\n    target: { type: [String, Object] as PropType<MaybeHTMLElementOrSelector>, default: undefined },\n    /** Element where dropdown content will be rendered. */\n    teleport: { type: [String, Object] as PropType<MaybeHTMLElementOrSelector>, default: undefined },\n    preventOverflow: { type: Boolean, default: false },\n    keepAnchorWidth: { type: Boolean, default: false },\n    isContentHoverable: { type: Boolean, default: true },\n    closeOnContentClick: { type: Boolean, default: true },\n    closeOnClickOutside: { type: Boolean, default: true },\n    closeOnAnchorClick: { type: Boolean, default: true },\n    hoverOverTimeout: { type: Number, default: 30 },\n    hoverOutTimeout: { type: Number, default: 200 },\n    offset: { type: [Array, Number] as PropType<DropdownOffsetProp>, default: 0 },\n    stickToEdges: { type: Boolean, default: false },\n    autoPlacement: { type: Boolean, default: true },\n    cursor: { type: Boolean, default: false },\n    trigger: {\n      type: String as PropType<'click' | 'right-click' | 'hover' | 'dblclick' | 'none'>,\n      default: 'click',\n      validator: (value: string) => ['click', 'right-click', 'hover', 'dblclick', 'none'].includes(value),\n    },\n    /** Not reactive */\n    keyboardNavigation: { type: Boolean, default: false },\n\n    ariaLabel: { type: String, default: '$t:toggleDropdown' },\n  },\n\n  emits: [...useStatefulEmits, 'anchor-click', 'anchor-right-click', 'content-click', 'click-outside', 'close', 'open', 'anchor-dblclick'],\n\n  setup (props, { emit, slots, attrs }) {\n    const contentRef = shallowRef<HTMLElement>()\n\n    const { valueComputed: statefulVal } = useStateful(props, emit)\n    const valueComputed = computed({\n      get: () => statefulVal.value && !props.disabled && !props.readonly,\n      set (val) {\n        statefulVal.value = val\n        if (val) {\n          emit('open')\n        } else {\n          emit('close')\n        }\n      },\n    })\n\n    const computedClass = useBem('va-dropdown', () => pick(props, ['disabled']))\n\n    const { debounced: debounceHover, cancel: cancelHoverDebounce } = useDebounceFn(toRef(props, 'hoverOverTimeout'))\n    const { debounced: debounceUnHover, cancel: cancelUnHoverDebounce } = useDebounceFn(toRef(props, 'hoverOutTimeout'))\n\n    const onMouseEnter = () => {\n      if (props.trigger !== 'hover' || props.disabled) { return }\n\n      debounceHover(() => { valueComputed.value = true })\n      cancelUnHoverDebounce()\n    }\n\n    const onMouseLeave = () => {\n      if (props.trigger !== 'hover' || props.disabled) { return }\n\n      if (props.isContentHoverable) {\n        debounceUnHover(() => { valueComputed.value = false })\n      } else {\n        valueComputed.value = false\n      }\n      cancelHoverDebounce()\n    }\n\n    const emitAndClose = (eventName: Parameters<typeof emit>[0], close?: boolean, e?: Event) => {\n      emit(eventName, e)\n      if (close && props.trigger !== 'none') { valueComputed.value = false }\n    }\n\n    const elRef = useHTMLElement('computedAnchorRef')\n\n    if (props.keyboardNavigation) {\n      useKeyboardNavigation(elRef, valueComputed)\n    }\n\n    useMouseNavigation(elRef, {\n      click (e) {\n        if ((props.trigger !== 'click' && kebabCase(props.trigger) !== 'right-click') || props.disabled) { return }\n\n        if (valueComputed.value) {\n          emitAndClose('anchor-click', props.closeOnAnchorClick, e)\n        } else {\n          if (props.trigger !== 'click') { return }\n          valueComputed.value = true\n          emit('anchor-click', e)\n        }\n      },\n      contextmenu (e) {\n        if (kebabCase(props.trigger) !== 'right-click' || props.disabled) { return }\n        e.preventDefault()\n\n        if (valueComputed.value) {\n          emitAndClose('anchor-right-click', props.closeOnAnchorClick, e)\n\n          if (props.cursor) {\n            nextTick(() => { valueComputed.value = true })\n          }\n        } else {\n          valueComputed.value = true\n          emit('anchor-right-click', e)\n        }\n      },\n      dblclick (e) {\n        if (props.trigger !== 'dblclick' || props.disabled) { return }\n        if (valueComputed.value) {\n          emitAndClose('anchor-dblclick', props.closeOnAnchorClick, e)\n\n          if (props.cursor) {\n            nextTick(() => { valueComputed.value = true })\n          }\n        } else {\n          valueComputed.value = true\n          emit('anchor-dblclick', e)\n        }\n      },\n      mouseenter: onMouseEnter,\n      mouseleave: onMouseLeave,\n    })\n\n    const { anchorRef: computedAnchorRef } = useAnchorSelector(props)\n    useClickOutside([computedAnchorRef, contentRef], () => {\n      if (props.closeOnClickOutside && valueComputed.value) {\n        emitAndClose('click-outside', props.closeOnClickOutside)\n      }\n    })\n\n    const cursorAnchor = useCursorAnchor(computedAnchorRef, valueComputed)\n    const document = useDocument()\n    const isPopoverFloating = computed(() => props.preventOverflow)\n\n    const target = useHTMLElementSelector(computed(() => props.target || 'body'))\n    const teleport = useHTMLElementSelector(computed(() => props.teleport))\n\n    const targetComputed = computed(() => {\n      if (computedAnchorRef.value && !target.value?.contains?.(computedAnchorRef.value)) { return document.value?.body }\n\n      return target.value\n    })\n\n    const teleportTargetComputed = computed<HTMLElement | undefined>(() => {\n      if (teleport.value) {\n        return teleport.value\n      }\n\n      if (!isPopoverFloating.value) {\n        // If not floating just render inside the parent element\n        return elRef.value?.parentElement || undefined\n      }\n\n      return targetComputed.value\n    })\n\n    const teleportDisabled = computed(() => {\n      if (teleport.value) { return false }\n      return props.disabled || !isPopoverFloating.value\n    })\n\n    useDropdown(\n      computed(() => props.cursor ? cursorAnchor.value : computedAnchorRef.value),\n      contentRef,\n      computed(() => ({\n        keepAnchorWidth: props.keepAnchorWidth,\n        offset: props.offset,\n        stickToEdges: props.stickToEdges,\n        autoPlacement: props.autoPlacement,\n        root: teleportTargetComputed.value,\n        viewport: targetComputed.value,\n      })),\n      props,\n    )\n\n    const isMounted = useIsMounted()\n\n    return {\n      ...useTranslation(),\n      isMounted,\n      valueComputed,\n      computedAnchorRef,\n      computedClass,\n      onMouseEnter,\n      teleportTargetComputed,\n      teleportDisabled,\n      onMouseLeave,\n      emitAndClose,\n      contentRef,\n    }\n  },\n\n  render () {\n    const slotBinds = {\n      value: this.valueComputed.value,\n      hide: () => { this.valueComputed.value = false },\n      show: () => { this.valueComputed.value = true },\n    }\n\n    const defaultSlotVNode = renderSlotNode(this.$slots.default, slotBinds, {\n      ref: 'contentRef',\n      class: 'va-dropdown__content-wrapper',\n      onMouseOver: () => this.$props.isContentHoverable && this.onMouseEnter(),\n      onMouseOut: () => this.onMouseLeave(),\n      onClick: () => this.emitAndClose('content-click', this.$props.closeOnContentClick),\n    })\n\n    const anchorSlotVNode = renderSlotNode(this.$slots.anchor, slotBinds, {\n      ref: 'computedAnchorRef',\n      role: 'button',\n      class: ['va-dropdown', ...this.computedClass.asArray.value],\n      style: { position: 'relative' },\n      'aria-label': this.tp(this.$props.ariaLabel),\n      'aria-disabled': this.$props.disabled,\n      'aria-expanded': !!this.valueComputed.value,\n      ...this.$attrs,\n    })\n\n    if (!anchorSlotVNode) {\n      warn('VaDropdown: You must provide an anchor slot')\n      return\n    }\n\n    if (!defaultSlotVNode) {\n      warn('VaDropdown: default slot is missing')\n      return h(anchorSlotVNode)\n    }\n\n    return h(Fragment, {}, [\n      anchorSlotVNode,\n\n      (this.isMounted && this.valueComputed) && h(\n        Teleport,\n        {\n          to: this.teleportTargetComputed,\n          disabled: this.teleportDisabled,\n        },\n        [defaultSlotVNode],\n      ),\n    ])\n  },\n})\n</script>\n\n<style lang=\"scss\">\n@import '../../styles/resources';\n@import 'variables';\n\n.va-dropdown {\n  /* Solved the alignment problem (if we try to align inline and block elements) */\n  line-height: var(--va-dropdown-line-height);\n  font-family: var(--va-font-family);\n  display: var(--va-dropdown-display);\n  position: relative;\n  max-width: 100%;\n  vertical-align: middle;\n\n  &--disabled {\n    @include va-disabled;\n  }\n\n  &__content-wrapper {\n    z-index: var(--va-dropdown-content-wrapper-z-index);\n    font-family: var(--va-font-family);\n    top: 0;\n    left: 0;\n    position: absolute;\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}