{"ast":null,"code":"import { ref, computed, watch } from \"vue\";\nimport { u as useThrottleProps, b as useThrottleFunction } from \"../../../composables/useThrottle-cdbdff3a.mjs\";\nconst useSortableProps = {\n  ...useThrottleProps,\n  sortBy: {\n    type: String\n  },\n  sortingOrder: {\n    type: String\n  }\n};\nconst useSortable = (columns, filteredRows, props, emit) => {\n  const sortByFallback = ref(\"\");\n  const sortBySync = computed({\n    get() {\n      if (props.sortBy === void 0) {\n        return sortByFallback.value;\n      } else {\n        return props.sortBy;\n      }\n    },\n    set(value) {\n      if (props.sortBy === void 0) {\n        sortByFallback.value = value;\n      }\n      emit(\"update:sortBy\", value);\n    }\n  });\n  const sortingOrderFallback = ref(null);\n  const sortingOrderSync = computed({\n    get() {\n      if (props.sortingOrder === void 0) {\n        return sortingOrderFallback.value;\n      } else {\n        return props.sortingOrder;\n      }\n    },\n    set(value) {\n      if (props.sortingOrder === void 0) {\n        sortingOrderFallback.value = value;\n      }\n      emit(\"update:sortingOrder\", value);\n    }\n  });\n  const sortedRows = computed(() => {\n    if (filteredRows.value.length <= 1) {\n      return filteredRows.value;\n    }\n    const columnIndex = columns.value.findIndex(({\n      name,\n      sortable\n    }) => sortBySync.value === name && sortable);\n    const column = columns.value[columnIndex];\n    if (!column) {\n      return filteredRows.value;\n    }\n    const sortingOrderRatio = sortingOrderSync.value === \"desc\" ? -1 : 1;\n    return [...filteredRows.value].sort((a, b) => {\n      if (sortingOrderSync.value === null) {\n        return a.initialIndex - b.initialIndex;\n      } else {\n        const firstValue = a.cells[columnIndex].value;\n        const secondValue = b.cells[columnIndex].value;\n        const firstSource = a.cells[columnIndex].source;\n        const secondSource = b.cells[columnIndex].source;\n        return sortingOrderRatio * (typeof column.sortingFn === \"function\" ? column.sortingFn(firstSource, secondSource) : firstValue.localeCompare(secondValue));\n      }\n    });\n  });\n  watch(sortedRows, () => {\n    emit(\"sorted\", {\n      sortBy: sortBySync.value,\n      sortingOrder: sortingOrderSync.value,\n      items: sortedRows.value.map(row => row.source),\n      itemsIndexes: sortedRows.value.map(row => row.initialIndex)\n    });\n  });\n  const getNextSortingOptionsValue = (value, options) => {\n    const index = options.findIndex(sortingValue => sortingValue === value);\n    return index !== -1 ? options[(index + 1) % options.length] : options[0];\n  };\n  function toggleSorting(column) {\n    if (column.name === sortBySync.value) {\n      sortingOrderSync.value = getNextSortingOptionsValue(sortingOrderSync.value, column.sortingOptions);\n    } else {\n      sortBySync.value = column.name;\n      sortingOrderSync.value = column.sortingOptions[0];\n    }\n  }\n  const toggleSortingThrottled = useThrottleFunction(toggleSorting, props);\n  const sortingOrderIconName = computed(() => {\n    return sortingOrderSync.value === \"asc\" ? \"va-arrow-up\" : sortingOrderSync.value === \"desc\" ? \"va-arrow-down\" : \"unfold_more\";\n  });\n  return {\n    sortBySync,\n    sortingOrderSync,\n    toggleSorting: toggleSortingThrottled,\n    sortedRows,\n    sortingOrderIconName\n  };\n};\nexport { useSortable as a, useSortableProps as u };","map":{"version":3,"names":["useSortableProps","useThrottleProps","sortBy","type","String","sortingOrder","useSortable","columns","filteredRows","props","emit","sortByFallback","ref","sortBySync","computed","get","value","set","sortingOrderFallback","sortingOrderSync","sortedRows","length","columnIndex","findIndex","name","sortable","column","sortingOrderRatio","sort","a","b","initialIndex","firstValue","cells","secondValue","firstSource","source","secondSource","sortingFn","localeCompare","watch","items","map","row","itemsIndexes","getNextSortingOptionsValue","options","index","sortingValue","toggleSorting","sortingOptions","toggleSortingThrottled","useThrottleFunction","sortingOrderIconName"],"sources":["../../../../../../src/components/va-data-table/hooks/useSortable.ts"],"sourcesContent":["import { PropType, computed, ref, Ref, watch, ExtractPropTypes, ComputedRef } from 'vue'\n\nimport { useThrottleFunction, useThrottleProps } from '../../../composables'\n\nimport type {\n  DataTableColumnInternal,\n  DataTableRow,\n  DataTableItem,\n  DataTableSortingOrder,\n  DataTableSortingOptions,\n} from '../types'\n\nexport const useSortableProps = {\n  ...useThrottleProps,\n  sortBy: { type: String as PropType<string | undefined> },\n  sortingOrder: { type: String as PropType<DataTableSortingOrder | undefined> },\n}\n\nexport type TSortedArgs = { sortBy: string, sortingOrder: DataTableSortingOrder, items: DataTableItem[], itemsIndexes: number[] }\n\nexport type TSortableEmits = (\n  event: 'update:sortBy' | 'update:sortingOrder' | 'sorted',\n  args: string | DataTableSortingOrder | TSortedArgs,\n) => void\n\nexport type TSortIcon = 'va-arrow-up' | 'va-arrow-down' | 'unfold_more'\n\nexport const useSortable = (\n  columns: Ref<DataTableColumnInternal[]>,\n  filteredRows: Ref<DataTableRow[]>,\n  props: ExtractPropTypes<typeof useSortableProps>,\n  emit: TSortableEmits,\n) => {\n  const sortByFallback = ref('')\n  const sortBySync = computed<string>({\n    get () {\n      if (props.sortBy === undefined) {\n        return sortByFallback.value\n      } else {\n        return props.sortBy\n      }\n    },\n\n    set (value) {\n      if (props.sortBy === undefined) {\n        sortByFallback.value = value\n      }\n\n      emit('update:sortBy', value)\n    },\n  })\n\n  const sortingOrderFallback = ref(null as DataTableSortingOrder)\n  const sortingOrderSync = computed<DataTableSortingOrder>({\n    get () {\n      if (props.sortingOrder === undefined) {\n        return sortingOrderFallback.value\n      } else {\n        return props.sortingOrder\n      }\n    },\n\n    set (value) {\n      if (props.sortingOrder === undefined) {\n        sortingOrderFallback.value = value\n      }\n\n      emit('update:sortingOrder', value)\n    },\n  })\n\n  // sorts by string-value of a given row's cell (depending on by which column the table is sorted) if no sortingFn is\n  // provided. Otherwise uses that very sortingFn. If sortingOrder is `null` then restores the initial sorting order of\n  // the rows.\n  const sortedRows = computed(() => {\n    if (filteredRows.value.length <= 1) {\n      return filteredRows.value\n    }\n\n    const columnIndex = columns.value.findIndex(\n      ({ name, sortable }) => sortBySync.value === name && sortable,\n    )\n    const column = columns.value[columnIndex]\n\n    if (!column) {\n      return filteredRows.value\n    }\n\n    const sortingOrderRatio = sortingOrderSync.value === 'desc' ? -1 : 1\n\n    return [...filteredRows.value].sort((a, b) => {\n      if (sortingOrderSync.value === null) {\n        return a.initialIndex - b.initialIndex\n      } else {\n        const firstValue = a.cells[columnIndex].value\n        const secondValue = b.cells[columnIndex].value\n        const firstSource = a.cells[columnIndex].source\n        const secondSource = b.cells[columnIndex].source\n\n        return sortingOrderRatio * (\n          typeof column.sortingFn === 'function'\n            ? column.sortingFn(firstSource, secondSource)\n            : firstValue.localeCompare(secondValue)\n        )\n      }\n    })\n  })\n\n  // sort each time the sortBy or sortingOrder is changed (and also initially). Also if columns definitions are changed\n  // (because that potentially means that the user runtime-introduced a custom sorting function for a specific column)\n  watch(sortedRows, () => {\n    emit('sorted', {\n      sortBy: sortBySync.value,\n      sortingOrder: sortingOrderSync.value,\n      items: sortedRows.value.map(row => row.source),\n      itemsIndexes: sortedRows.value.map(row => row.initialIndex),\n    })\n  })\n\n  const getNextSortingOptionsValue = (value: DataTableSortingOrder, options: DataTableSortingOptions) => {\n    const index = options.findIndex((sortingValue) => sortingValue === value)\n\n    return index !== -1\n      ? options[(index + 1) % options.length]\n      : options[0]\n  }\n\n  // a function to invoke when a heading of the table is clicked.\n  // Sets the clicked heading's column as a one to sort by and toggles the sorting order from \"asc\" to \"desc\" to `null`\n  // (un-sorted) if the same column is clicked again or sets sorting order to \"asc\" if some other column is chosen.\n  function toggleSorting (column: DataTableColumnInternal) {\n    if (column.name === sortBySync.value) {\n      sortingOrderSync.value = getNextSortingOptionsValue(sortingOrderSync.value, column.sortingOptions)\n    } else {\n      sortBySync.value = column.name\n      sortingOrderSync.value = column.sortingOptions[0]\n    }\n  }\n\n  const toggleSortingThrottled = useThrottleFunction(toggleSorting, props)\n\n  const sortingOrderIconName = computed(() => {\n    return sortingOrderSync.value === 'asc'\n      ? 'va-arrow-up'\n      : sortingOrderSync.value === 'desc'\n        ? 'va-arrow-down'\n        : 'unfold_more'\n  }) as ComputedRef<TSortIcon>\n\n  return {\n    sortBySync,\n    sortingOrderSync,\n    toggleSorting: toggleSortingThrottled,\n    sortedRows,\n    sortingOrderIconName,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}