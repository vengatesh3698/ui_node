{"ast":null,"code":"import { ref, watch, computed } from \"vue\";\nconst useStatefulProps = {\n  stateful: {\n    type: Boolean,\n    default: false\n  },\n  modelValue: {\n    type: void 0\n  }\n};\nconst createStatefulProps = (modelValueType, statefulDefault = false) => {\n  return {\n    stateful: {\n      type: Boolean,\n      default: statefulDefault\n    },\n    modelValue: {\n      type: modelValueType\n    }\n  };\n};\nconst useStatefulEmits = [\"update:modelValue\"];\nconst useStateful = (props, emit, key = \"modelValue\", options = {}) => {\n  const {\n    defaultValue,\n    eventName\n  } = options;\n  const event = eventName || `update:${key.toString()}`;\n  const valueState = ref(defaultValue === void 0 ? props[key] : defaultValue);\n  let unwatchModelValue;\n  const watchModelValue = () => {\n    unwatchModelValue = watch(() => props[key], modelValue => {\n      valueState.value = modelValue;\n    });\n  };\n  watch(() => props.stateful, stateful => {\n    stateful ? watchModelValue() : unwatchModelValue == null ? void 0 : unwatchModelValue();\n  }, {\n    immediate: true\n  });\n  const valueComputed = computed({\n    get: () => {\n      if (props.stateful) {\n        return valueState.value;\n      }\n      return props[key];\n    },\n    set: value => {\n      if (props.stateful) {\n        valueState.value = value;\n      }\n      emit(event, value);\n    }\n  });\n  return {\n    valueComputed\n  };\n};\nexport { useStatefulProps as a, useStateful as b, createStatefulProps as c, useStatefulEmits as u };","map":{"version":3,"names":["useStatefulProps","stateful","type","Boolean","default","modelValue","createStatefulProps","modelValueType","statefulDefault","useStatefulEmits","useStateful","props","emit","key","options","defaultValue","eventName","event","toString","valueState","ref","unwatchModelValue","watchModelValue","watch","value","immediate","valueComputed","computed","get","set"],"sources":["../../../../src/composables/useStateful.ts"],"sourcesContent":["import { ref, computed, watch, PropType, Ref } from 'vue'\n\nexport type StatefulProps = {\n  stateful: boolean\n}\n\nexport type StatefulOptions<T> = {\n  eventName?: string\n  defaultValue: T\n}\n\n/**\n * You could add these props to any component by destructuring them inside props option.\n * @example\n * props: { ...useStatefulProps, componentsOwnProp, etc. }\n * It's better to add props at the beginning, to make sure that Component own props will be used instead in case of collision\n */\nexport const useStatefulProps = {\n  stateful: { type: Boolean as PropType<boolean>, default: false },\n  modelValue: { type: undefined as any },\n}\n\nexport const createStatefulProps = <T>(modelValueType?: T, statefulDefault = false) => {\n  return {\n    stateful: { type: Boolean as PropType<boolean>, default: statefulDefault },\n    modelValue: { type: modelValueType },\n  }\n}\n\nexport const useStatefulEmits = ['update:modelValue'] as const\n\n/**\n * Returns `valueComputed` that is proxy for `modelValue` or given key of the props\n * if `stateful` prop is `false`\n * Record<any, any> & Record<'modelValue', T>\n */\nexport const useStateful = <Props extends StatefulProps, Name extends string, Key extends keyof Props>(\n  props: Props,\n  emit: (name: Name, ...args: any[]) => void,\n  key: Key = 'modelValue' as Key,\n  options = {} as StatefulOptions<Props[Key]>,\n) => {\n  const { defaultValue, eventName } = options\n  const event = (eventName || `update:${key.toString()}`) as Name\n  const valueState = ref(defaultValue === undefined ? props[key] : defaultValue) as Ref\n  let unwatchModelValue: Function\n\n  const watchModelValue = () => {\n    unwatchModelValue = watch(() => props[key], (modelValue) => {\n      valueState.value = modelValue\n    })\n  }\n\n  watch(() => props.stateful, (stateful: boolean) => {\n    stateful ? watchModelValue() : unwatchModelValue?.()\n  }, { immediate: true })\n\n  const valueComputed = computed({\n    get: () => {\n      if (props.stateful) { return valueState.value }\n\n      return props[key]\n    },\n    set: (value) => {\n      if (props.stateful) { valueState.value = value }\n\n      emit(event, value)\n    },\n  })\n\n  return { valueComputed }\n}\n"],"mappings":";AAiBO,MAAMA,gBAAA,GAAmB;EAC9BC,QAAA,EAAU;IAAEC,IAAA,EAAMC,OAAA;IAA8BC,OAAA,EAAS;EAAM;EAC/DC,UAAA,EAAY;IAAEH,IAAA,EAAM;EAAiB;AACvC;AAEO,MAAMI,mBAAA,GAAsBA,CAAIC,cAAA,EAAoBC,eAAA,GAAkB,UAAU;EAC9E;IACLP,QAAA,EAAU;MAAEC,IAAA,EAAMC,OAAA;MAA8BC,OAAA,EAASI;IAAgB;IACzEH,UAAA,EAAY;MAAEH,IAAA,EAAMK;IAAe;EAAA;AAEvC;AAEa,MAAAE,gBAAA,GAAmB,CAAC,mBAAmB;AAOvC,MAAAC,WAAA,GAAcA,CACzBC,KAAA,EACAC,IAAA,EACAC,GAAA,GAAW,cACXC,OAAA,GAAU,OACP;EACG;IAAEC,YAAA;IAAcC;EAAc,IAAAF,OAAA;EACpC,MAAMG,KAAA,GAASD,SAAA,IAAa,UAAUH,GAAA,CAAIK,QAAA,CAAS;EACnD,MAAMC,UAAA,GAAaC,GAAA,CAAIL,YAAA,KAAiB,SAAYJ,KAAA,CAAME,GAAG,IAAIE,YAAY;EACzE,IAAAM,iBAAA;EAEJ,MAAMC,eAAA,GAAkBA,CAAA,KAAM;IAC5BD,iBAAA,GAAoBE,KAAA,CAAM,MAAMZ,KAAA,CAAME,GAAG,GAAIR,UAAA,IAAe;MAC1Dc,UAAA,CAAWK,KAAA,GAAQnB,UAAA;IAAA,CACpB;EAAA;EAGHkB,KAAA,CAAM,MAAMZ,KAAA,CAAMV,QAAA,EAAWA,QAAA,IAAsB;IACtCA,QAAA,GAAAqB,eAAA,KAAoBD,iBAAA,oBAAAA,iBAAA;EAAoB,GAClD;IAAEI,SAAA,EAAW;EAAA,CAAM;EAEtB,MAAMC,aAAA,GAAgBC,QAAA,CAAS;IAC7BC,GAAA,EAAKA,CAAA,KAAM;MACT,IAAIjB,KAAA,CAAMV,QAAA,EAAU;QAAE,OAAOkB,UAAA,CAAWK,KAAA;MAAM;MAE9C,OAAOb,KAAA,CAAME,GAAG;IAClB;IACAgB,GAAA,EAAML,KAAA,IAAU;MACd,IAAIb,KAAA,CAAMV,QAAA,EAAU;QAAEkB,UAAA,CAAWK,KAAA,GAAQA,KAAA;MAAM;MAE/CZ,IAAA,CAAKK,KAAA,EAAOO,KAAK;IACnB;EAAA,CACD;EAED,OAAO;IAAEE;EAAc;AACzB"},"metadata":{},"sourceType":"module","externalDependencies":[]}