{"ast":null,"code":"import { _ as _sfc_main } from \"./VaFileUpload.vue_vue_type_script_lang-5f28f3d3.mjs\";\nimport { resolveComponent, openBlock, createElementBlock, normalizeClass, normalizeStyle, renderSlot, createElementVNode, toDisplayString, createCommentVNode, createVNode, withCtx, createTextVNode, createBlock, mergeProps } from \"vue\";\nimport { _ as _export_sfc } from \"../../../plugin-vue_export-helper-cc2b3d55.mjs\";\nconst VaFileUpload_vue_vue_type_style_index_0_lang = \"\";\nconst _hoisted_1 = {\n  class: \"va-file-upload__field\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"va-file-upload__field__text\"\n};\nconst _hoisted_3 = [\"accept\", \"multiple\", \"disabled\"];\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_va_button = resolveComponent(\"va-button\");\n  const _component_va_file_upload_list = resolveComponent(\"va-file-upload-list\");\n  const _component_va_modal = resolveComponent(\"va-modal\");\n  return openBlock(), createElementBlock(\"div\", {\n    class: normalizeClass([\"va-file-upload\", _ctx.computedClasses]),\n    style: normalizeStyle(_ctx.computedStyle)\n  }, [renderSlot(_ctx.$slots, \"default\", {}, () => [createElementVNode(\"div\", _hoisted_1, [_ctx.dropzone ? (openBlock(), createElementBlock(\"div\", _hoisted_2, toDisplayString(_ctx.tp(_ctx.dropZoneText)), 1)) : createCommentVNode(\"\", true), createVNode(_component_va_button, {\n    class: \"va-file-upload__field__button\",\n    disabled: _ctx.disabled,\n    \"aria-disabled\": _ctx.disabled,\n    color: _ctx.colorComputed,\n    style: normalizeStyle({\n      \"pointer-events\": _ctx.dropzoneHighlight ? \"none\" : void 0\n    }),\n    onChange: _ctx.changeFieldValue,\n    onClick: _ctx.callFileDialogue\n  }, {\n    default: withCtx(() => [createTextVNode(toDisplayString(_ctx.tp(_ctx.uploadButtonText)), 1)]),\n    _: 1\n  }, 8, [\"disabled\", \"aria-disabled\", \"color\", \"style\", \"onChange\", \"onClick\"])])]), createElementVNode(\"input\", {\n    ref: \"fileInputRef\",\n    type: \"file\",\n    class: \"va-file-upload__field__input\",\n    tabindex: -1,\n    \"aria-hidden\": \"true\",\n    accept: _ctx.fileTypes,\n    multiple: _ctx.type !== \"single\",\n    disabled: _ctx.disabled,\n    onChange: _cache[0] || (_cache[0] = (...args) => _ctx.changeFieldValue && _ctx.changeFieldValue(...args)),\n    onDragenter: _cache[1] || (_cache[1] = $event => _ctx.dropzoneHighlight = true),\n    onDragleave: _cache[2] || (_cache[2] = $event => _ctx.dropzoneHighlight = false)\n  }, null, 40, _hoisted_3), _ctx.files.length && !_ctx.$props.hideFileList ? (openBlock(), createBlock(_component_va_file_upload_list, mergeProps({\n    key: 0\n  }, _ctx.fileUploadListProps, {\n    type: _ctx.type,\n    files: _ctx.files,\n    color: _ctx.colorComputed,\n    onRemove: _ctx.removeFile,\n    onRemoveSingle: _ctx.removeSingleFile\n  }), null, 16, [\"type\", \"files\", \"color\", \"onRemove\", \"onRemoveSingle\"])) : createCommentVNode(\"\", true), createVNode(_component_va_modal, {\n    modelValue: _ctx.modal,\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => _ctx.modal = $event),\n    \"hide-default-actions\": \"\",\n    title: \"File validation\",\n    message: \"File type is incorrect!\"\n  }, null, 8, [\"modelValue\"])], 6);\n}\nconst _VaFileUpload = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\nexport { _VaFileUpload as _ };","map":{"version":3,"names":["_hoisted_2","key","class","resolveComponent","openBlock","createElementBlock","normalizeClass","_ctx","computedClasses","style","normalizeStyle","computedStyle","renderSlot","$slots","createElementVNode","_hoisted_1","dropzone","toDisplayString","tp","dropZoneText","createCommentVNode","createVNode","_component_va_button","disabled","color","colorComputed","dropzoneHighlight","onChange","changeFieldValue","onClick","callFileDialogue","ref","type","tabindex","accept","fileTypes","multiple","_cache","args","onDragenter","$event","onDragleave","_hoisted_3","files","length","$props","hideFileList","createBlock","_component_va_file_upload_list","mergeProps","fileUploadListProps","onRemove","removeFile","onRemoveSingle","removeSingleFile","_component_va_modal","modelValue","modal","title","message"],"sources":["../../../../../src/components/va-file-upload/VaFileUpload.vue"],"sourcesContent":["<template>\n  <div\n    class=\"va-file-upload\"\n    :class=\"computedClasses\"\n    :style=\"computedStyle\"\n  >\n    <slot>\n      <div class=\"va-file-upload__field\">\n        <div\n          v-if=\"dropzone\"\n          class=\"va-file-upload__field__text\"\n        >\n          {{ tp(dropZoneText) }}\n        </div>\n        <va-button\n          class=\"va-file-upload__field__button\"\n          :disabled=\"disabled\"\n          :aria-disabled=\"disabled\"\n          :color=\"colorComputed\"\n          :style=\"{ 'pointer-events': dropzoneHighlight ? 'none' : undefined }\"\n          @change=\"changeFieldValue\"\n          @click=\"callFileDialogue\"\n        >\n          {{ tp(uploadButtonText) }}\n        </va-button>\n      </div>\n    </slot>\n\n    <input\n      ref=\"fileInputRef\"\n      type=\"file\"\n      class=\"va-file-upload__field__input\"\n      :tabindex=\"-1\"\n      aria-hidden=\"true\"\n      :accept=\"fileTypes\"\n      :multiple=\"type !== 'single'\"\n      :disabled=\"disabled\"\n      @change=\"changeFieldValue\"\n      @dragenter=\"dropzoneHighlight = true\"\n      @dragleave=\"dropzoneHighlight = false\"\n    >\n    <va-file-upload-list\n      v-if=\"files.length && !$props.hideFileList\"\n      v-bind=\"fileUploadListProps\"\n      :type=\"type\"\n      :files=\"files\"\n      :color=\"colorComputed\"\n      @remove=\"removeFile\"\n      @removeSingle=\"removeSingleFile\"\n    />\n    <va-modal\n      v-model=\"modal\"\n      hide-default-actions\n      title=\"File validation\"\n      message=\"File type is incorrect!\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, ref, toRef, shallowRef, provide, PropType } from 'vue'\n\nimport { useColors, useComponentPresetProp, useBem, useTranslation } from '../../composables'\n\nimport { VaFileUploadKey, VaFile } from './types'\n\nimport { VaButton, VaModal } from '../index'\nimport { VaFileUploadList } from './VaFileUploadList'\nimport { extractComponentProps, filterComponentProps } from '../../utils/component-options'\n\nconst VaFileUploadListProps = extractComponentProps(VaFileUploadList)\n\nexport default defineComponent({\n  name: 'VaFileUpload',\n\n  components: {\n    VaModal,\n    VaButton,\n    VaFileUploadList,\n  },\n\n  props: {\n    ...useComponentPresetProp,\n    ...VaFileUploadListProps,\n    fileTypes: { type: String, default: '' },\n    dropzone: { type: Boolean, default: false },\n    hideFileList: { type: Boolean, default: false },\n    color: { type: String, default: 'primary' },\n    disabled: { type: Boolean, default: false },\n    undo: { type: Boolean, default: false },\n    undoDuration: { type: Number, default: 3000 },\n    undoButtonText: { type: String, default: '$t:undo' },\n    dropZoneText: { type: String, default: '$t:dropzone' },\n    uploadButtonText: { type: String, default: '$t:uploadFile' },\n    deletedFileMessage: { type: String, default: '$t:fileDeleted' },\n    modelValue: {\n      type: [Object, Array] as PropType<VaFile | VaFile[]>,\n      default: () => [],\n    },\n    type: {\n      type: String as PropType<'list' | 'gallery' | 'single'>,\n      default: 'list',\n      validator: (value: string) => ['list', 'gallery', 'single'].includes(value),\n    },\n  },\n\n  emits: ['update:modelValue', 'file-removed', 'file-added'],\n\n  setup (props, { emit }) {\n    const fileInputRef = shallowRef<HTMLInputElement>()\n\n    const modal = ref(false)\n    const dropzoneHighlight = ref(false)\n\n    const { getColor, shiftHSLAColor } = useColors()\n    const colorComputed = computed(() => getColor(props.color))\n\n    const computedStyle = computed(() => ({\n      backgroundColor: props.dropzone\n        ? shiftHSLAColor(colorComputed.value, { a: dropzoneHighlight.value ? -0.82 : -0.92 })\n        : 'transparent',\n    }))\n\n    const computedClasses = useBem('va-file-upload', () => ({\n      dropzone: props.dropzone,\n      disabled: props.disabled,\n    }))\n\n    const files = computed<VaFile[]>({\n      get () { return Array.isArray(props.modelValue) ? props.modelValue : [props.modelValue] },\n      set (files) {\n        if (props.type === 'single') {\n          emit('update:modelValue', files[0])\n        } else {\n          emit('update:modelValue', files)\n        }\n      },\n    })\n\n    const validateFiles = (files: VaFile[]) => files.filter((file) => {\n      const fileName = file.name || file.url\n      if (!fileName) { return false }\n      if (file.url) { return true }\n\n      const MIMETypes = ['audio/*', 'video/*', 'image/*']\n      const isContainedMIMEType = MIMETypes.find((t) => props.fileTypes.includes(t))\n\n      if (isContainedMIMEType) {\n        // Do not validate MIMEType because there is too much to validate.\n        return true\n      }\n\n      const extension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase()\n\n      const isCorrectExt = props.fileTypes.includes(extension)\n      if (!isCorrectExt) { modal.value = true }\n\n      return isCorrectExt\n    })\n\n    const uploadFile = (e: Event | DragEvent) => {\n      const f = (e.target as HTMLInputElement)?.files || (e as DragEvent).dataTransfer?.files\n\n      if (!f) { return }\n\n      const validatedFiles = props.fileTypes ? validateFiles(Array.from(f)) : f\n\n      files.value = props.type === 'single' ? (validatedFiles as VaFile[]) : [...files.value, ...validatedFiles]\n\n      emit('file-added', validatedFiles)\n    }\n\n    const changeFieldValue = (e: Event | DragEvent) => {\n      uploadFile(e)\n\n      if (fileInputRef.value) {\n        fileInputRef.value.value = ''\n      }\n    }\n\n    const removeFile = (index: number) => {\n      if (index in files.value) {\n        const removedFile = files.value[index]\n        files.value = files.value.filter((item, idx) => idx !== index)\n        emit('file-removed', removedFile)\n      }\n    }\n\n    const removeSingleFile = () => {\n      if (files.value.length > 0) {\n        const removedFile = files.value[0]\n        files.value = []\n        emit('file-removed', removedFile)\n      }\n    }\n\n    const callFileDialogue = () => {\n      if (fileInputRef.value) {\n        fileInputRef.value.click()\n      }\n    }\n\n    onMounted(() => {\n      if (Array.isArray(files.value)) {\n        files.value = validateFiles(files.value)\n      }\n    })\n\n    const { tp } = useTranslation()\n\n    provide(VaFileUploadKey, {\n      undo: toRef(props, 'undo'),\n      disabled: toRef(props, 'disabled'),\n      undoDuration: toRef(props, 'undoDuration'),\n      undoButtonText: computed(() => tp(props.undoButtonText)),\n      deletedFileMessage: computed(() => tp(props.deletedFileMessage)),\n    })\n\n    return {\n      fileUploadListProps: filterComponentProps(VaFileUploadListProps),\n      modal,\n      dropzoneHighlight,\n      fileInputRef,\n      colorComputed,\n      computedStyle,\n      computedClasses,\n      files,\n      tp,\n      uploadFile,\n      changeFieldValue,\n      removeFile,\n      removeSingleFile,\n      callFileDialogue,\n    }\n  },\n})\n</script>\n\n<style lang='scss'>\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-file-upload {\n  position: var(--va-file-upload-position);\n  font-family: var(--va-font-family);\n  margin: var(--va-file-upload-margin);\n\n  .va-file-upload-list {\n    margin-top: var(--va-file-upload-list-margin-top);\n  }\n\n  &__field {\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    position: relative;\n\n    &__button {\n      margin: var(--va-file-upload-dropzone-field-button-margin);\n      z-index: 10;\n    }\n\n    &__text {\n      padding-right: var(--va-file-upload-dropzone-field-text-pr);\n    }\n\n    &__input {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      width: 100%;\n      color: transparent;\n      opacity: 0;\n      cursor: pointer;\n\n      &::-webkit-file-upload-button {\n        cursor: pointer;\n      }\n    }\n  }\n\n  &--dropzone {\n    background-color: var(--va-file-upload-dropzone-background-color);\n    overflow: hidden;\n    border-radius: var(--va-file-upload-dropzone-border-radius);\n    cursor: var(--va-file-upload-dropzone-cursor);\n\n    .va-file-upload__field {\n      justify-content: center;\n      display: flex;\n      align-items: center;\n      padding: var(--va-file-upload-dropzone-field-padding);\n      transition: height 0.2s;\n      overflow: visible;\n      flex-wrap: wrap;\n\n      @include media-breakpoint-down(sm) {\n        flex-direction: column;\n        padding: var(--va-file-upload-dropzone-field-padding-sm);\n\n        &__text {\n          padding: var(--va-file-upload-dropzone-text-padding-sm);\n          text-align: center;\n        }\n      }\n    }\n\n    .va-file-upload-list {\n      padding: var(--va-file-upload-dropzone-list-padding);\n      margin-top: 0;\n    }\n  }\n\n  &--disabled {\n    .va-file-upload__field__input {\n      cursor: default;\n\n      &::-webkit-file-upload-button {\n        cursor: inherit;\n      }\n    }\n  }\n\n  .va-button {\n    @include keyboard-focus-outline($offset: -2px);\n  }\n}\n</style>\n"],"mappings":";;;;;;;MAUUA,UAAA,GAAM;EAAAC,GAAA;EAAAC,KAAA;;;;;;8BATdC,gBAAA,CAuDM;EApDE,OAAAC,SAAA,IAAAC,kBAAA,CAAE,OAAa;IAAAH,KAAA,EAAAI,cAAA,oBAAAC,IAAA,CAAAC,eAAA;IAErBC,KAAA,EAoBOC,cAAA,CAAAH,IAAA,CAAAI,aAAA;EAAA,IAAAC,UAAA,CAjBKL,IAAA,CAAQM,MAAA,wBADhBC,kBAAA,QAAAC,UAAA,GAMAR,IAAA,CAAAS,QAAA,IAAAZ,SAAA,IAAAC,kBAAA,QAAAL,UAAA,EAAAiB,eAAA,CAAAV,IAAA,CAAAW,EAAA,CAAAX,IAAA,CAAAY,YAAA,UACEC,kBAAA,CAAM,WAAAC,WAAA,CACKC,oBAAA,EAAQ;IAClBpB,KAAA;IACAqB,QAAA,EAAOhB,IAAA,CAAAgB,QAAA;IACP,iBAAKhB,IAAA,CAAAgB,QAAA;IACLC,KAAA,EAAQjB,IAAA,CAAAkB,aAAA;IACRhB,KAAA,EAAKC,cAAA,CAAE;MAAgB,kBAAAH,IAAA,CAAAmB,iBAAA;IAAA;IAAAC,QAAA,EAAApB,IAAA,CAAAqB,gBAAA;IAAAC,OAAA,EAAAtB,IAAA,CAAAuB;;;;gFAO9B,KAEahB,kBAAA;IACXiB,GAAA,EAAK;IACJC,IAAA;IACD9B,KAAA;IACC+B,QAAA,EAAQ;IACR,eAAU;IACVC,MAAA,EAAQ3B,IAAA,CAAE4B,SAAA;IACVC,QAAA,EAAM7B,IAAA,CAAAyB,IAAA;IACNT,QAAA,EAAShB,IAAA,CAAAgB,QAAA;IACTI,QAAA,EAAAU,MAAA,CAAS,OAAAA,MAAA,UAAAC,IAAA,KAAE/B,IAAA,CAAiBqB,gBAAA,IAAArB,IAAA,CAAAqB,gBAAA,IAAAU,IAAA;IAAAC,WAAA,EAAAF,MAAA,QAAAA,MAAA,MAAAG,MAAA,IAAAjC,IAAA,CAAAmB,iBAAA;IAGvBe,WAAA,EAAMJ,MAAA,CAAM,CAAK,MAAAA,MAAA,CAAO,CAAY,IAAAG,MAAA,IAAAjC,IAAA,CAAAmB,iBAAA;EAAA,GAD5C,UAAAgB,UAAA,GAGGnC,IAAA,CAAAoC,KAAA,CAAMC,MAAA,IAAI,CAAArC,IAAA,CAAAsC,MAAA,CAAAC,YAAA,IAAA1C,SAAA,IACE2C,WAAA,CAAAC,8BAAA,EAAAC,UAAA;IAAAhD,GAAA;EAAA,GAAAM,IAAA,CAAA2C,mBAAA;IACZlB,IAAA,EAAKzB,IAAA,CAAEyB,IAAA;IACPW,KAAA,EAAQpC,IAAA,CAAAoC,KAAA;IACRnB,KAAA,EAAAjB,IAAA,CAAAkB,aAAA;IAAA0B,QAAA,EAAA5C,IAAA,CAAA6C,UAAA;IAAAC,cAAA,EAAA9C,IAAA,CAAA+C;EAEH,UAKE,IAJc,6DAAAlC,kBAAA,YAAAC,WAAA,CAAAkC,mBAAA;IACdC,UAAA,EAAAjD,IAAA,CAAAkD,KAAA;IACA,uBAAMpB,MAAA,CAAiB,OAAAA,MAAA,MAAAG,MAAA,IAAAjC,IAAA,CAAAkD,KAAA,GAAAjB,MAAA;IACvB,wBAAQ;IAAAkB,KAAA;IAAAC,OAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}